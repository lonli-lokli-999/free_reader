"use strict";import{header}from"./modules/header.js";import{main}from"./modules/main.js";const file_processor=new Worker("js/workers/reader_worker.js");file_processor.addEventListener("message",e=>app.bookUpdate(e.data)),window.installDefaultSettings=()=>{let e=settingsModel.get();fetch("./data/settings.json").then(e=>e.json()).then(t=>{t.forEach(t=>{if(!t.css)return null;let o=e[t.css]?e[t.css]:t.value;document.querySelector(":root").style.setProperty(t.css,o)})})},window.installDefaultTheme=()=>{document.querySelector(":root").style;let e=LSModel.get("user_themes");fetch("./data/themes.json").then(e=>e.json()).then(t=>{let o=t.concat(e);o.forEach(e=>{let t=localStorage.def_theme_name?o.find(e=>e.name==localStorage.def_theme_name):null,s=t?t.colors:null;s||(localStorage.def_theme_name=o[0].name,s=o[0].colors),activateTheme(s)})})},window.activateTheme=e=>{let t=document.querySelector(":root").style;e=e.split(" "),t.setProperty("--header-bg",e[0]),t.setProperty("--header-color",e[1]),t.setProperty("--content-bg",e[2]),t.setProperty("--content-color",e[3]),t.setProperty("--translucent-color",e[4]),t.setProperty("--translucent-bg",e[5])},window.msg=e=>{let t=document.createElement("div");t.classList.add("b-msg"),t.innerHTML=e,document.body.appendChild(t),setTimeout(()=>t.remove(),3e3)},window.settingsModel={get:()=>localStorage.user_settings?JSON.parse(localStorage.user_settings):{},set(e,t){let o=this.get();o[e]=t,localStorage.user_settings=JSON.stringify(o)}},window.LSModel={get(e,t){let o=t?Object.keys(t):[],s=null;return s=(localStorage[e]?JSON.parse(localStorage[e]):[]).filter(e=>{let s=!0;return o.forEach(o=>{s=e[o]==t[o]}),s}),s},set(e,t,o){let s=this.get(e),a=!1;o&&(a=s.findIndex(e=>e[o]==t[o])),a||(t.$id=this.generateId(),s.push(t)),a&&(t.$id=s[a].$id,s[a]=t),localStorage[e]=JSON.stringify(s)},del(e,t){let o=this.get(e).filter(e=>e.$id!=t);localStorage[e]=JSON.stringify(o)},generateId:()=>(new Date).getTime()},window.readingStatus={table:()=>localStorage.books_progress?JSON.parse(localStorage.books_progress):[],update(e,t){let o=this.table(),s=o.findIndex(t=>t.name==e);-1==s?o.push({name:e,progress:t}):o[s].progress=t,localStorage.books_progress=JSON.stringify(o)},last(e){let t=this.table().find(t=>t.name==e);return t?t.progress:0}};const app=new Vue({el:".app",data:{file:null,book:null,curent_reading_status:void 0},computed:{book_open(){return console.log("Computed book open"),!!this.book}},template:'\n\t\t<div class="app">\n\t\t\t<div \n\t\t\t\tis="app_header"\n\t\t\t\t@select="selectFile"\n\t\t\t\t@flibopen="bookUpdate"\n\t\t\t\t:curent_reading_status="curent_reading_status"\n\t\t\t\t:book_open="book_open">\n\t\t\t</div>\n\t\t\t<div \n\t\t\t\tis="app_main" \n\t\t\t\t:book="book"\n\t\t\t\t@changeReadingStatus="changeReadingStatus">\n\t\t\t</div>\n\t\t</div>\n\t',components:{app_header:header,app_main:main},methods:{selectFile(e){file_processor.postMessage(e)},bookUpdate(e){e.progress=readingStatus.last(e.title),this.book=e},changeReadingStatus(e){this.curent_reading_status=e,this.book&&readingStatus.update(this.book.title,e)}}});installDefaultSettings(),installDefaultTheme();